<h1><%= @assignment.title %></h1>
<% if @assignment.repo_url != "" %>
<p><%= link_to "View on GitHub", @assignment.repo_url %></p>
<% end %>
<p>Type: <%= @assignment.assignment_type %></p>
<% if @assignment.due_date != "" %>
  <p>Due Date: <%= @assignment.due_date %></p>
<% end %>

<% if session[:token] %>
  <%= link_to "edit", edit_assignment_path(@assignment)%>
  <%= link_to 'delete', assignment_path(@assignment), method: :delete, data: {confirm: "Are you sure?"} %></p>
<% end %>

  <table>
    <% @submissions.each do |submission| %>
      <% issue = @issues[submission.student["github_user_id"]] %>
      <tr>
        <th><%= link_to submission.student["name"], edit_assignment_submission_path(@assignment, submission)  %></th>
        <% if issue %>
          <% issue_label = (issue[:state] == "open" ? "issue*" : "issue") %>
          <td class=<%= issue[:state] %>><%= link_to issue_label, issue[:url]%></td>
          <td><%= markdown(issue[:comments])%></td>
        <% else %>
	  <% if submission.assignment.assignment_type == "homework" %>
	    <td class="missing">no issue!</td>
	  <% elsif !submission.repo_url.blank? %>
	    <td><%= link_to "View on GitHub", submission.repo_url %></td>
	  <% else %>
	    <td></td>
	  <% end %>
          <td></td>
        <% end %>
          <td class="status">
            <% if submission.assignment.assignment_type == "homework" %>
  	         <%= check_box_tag submission.id, true, submission.status === "complete", :"data-submit" => assignment_submissions_path(@assignment) + "/#{submission.id}" %>
             <label for="<%= submission.id %>">Complete</label>
            <% elsif submission.assignment.assignment_type == "project" %>
	        <% if submission.status && !submission.status.blank? %>
		  Complete
		<% end %>
            <% end %>
          </td>
      </tr>
    <% end %>
  </table>
