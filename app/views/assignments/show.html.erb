<script>
  $(document).ready(function(){
    <% if session[:token] %>
    $(".status input").change(function(){
      $.ajax({
        url: "<%= assignment_submissions_path(@assignment) %>/" + this.id,
        type: "post",
        dataType: "json",
        data: {
          _method: "put",
	  submission: {
	    id: this.id,
	    checked: this.checked
	  }
        }
      }).always(function(response){
        console.dir(response);
      });
    });
    <% end %>
  });
</script>
<h1><%= @assignment.title %></h1>
<% if @assignment.repo_url != "" %>
<p><%= link_to "View on GitHub", @assignment.repo_url %></p>
<% end %>
<p>Type: <%= @assignment.assignment_type %></p>
<% if @assignment.due_date != "" %>
  <p>Due Date: <%= @assignment.due_date %></p>
<% end %>

<% if session[:token] %>
  <%= link_to "edit", edit_assignment_path(@assignment)%>
  <%= link_to 'delete', assignment_path(@assignment), method: :delete %></p>
<% end %>

  <table>
    <% @submissions.each do |submission| %>
      <% issue = @issues[submission.student["github_user_id"]] %>
      <tr>
        <th><%= link_to submission.student["name"], edit_assignment_submission_path(@assignment, submission)  %></th>
        <% if issue %>
          <% issue_label = (issue[:state] == "open" ? "issue*" : "issue") %>
          <td class=<%= issue[:state] %>><%= link_to issue_label, issue[:url]%></td>
          <td><%= simple_format issue[:comments]%></td>
        <% else %>
          <td>no issue!</td>
          <td></td>
        <% end %>
        <td class="status">
          <%= check_box_tag submission.id, true, submission.status === "complete" %>
          <label for="<%= submission.id %>">Complete</label>
        </td>
      </tr>
    <% end %>
  </table>
